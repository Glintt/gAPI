version: "3"
services:
  backend:
    restart: always
    build:
      context: ./api
    env_file: .env
    ports:
      - 8080:8080
      - 5000:5000
    volumes:
      - ./api/configs:/go/src/gAPIManagement/api/configs/

  frontend: 
    build: 
      context: ./dashboard 
    restart: always
    ports:
      - 8081:80

  rabbitlistener:
    restart: always
    build:
      context: ./api
      dockerfile: Dockerfile-rabbitlistener
    env_file: .env
    volumes:
      - ./api/configs:/go/src/gAPIManagement/api/configs/

  rabbit:
    restart: always
    image: "rabbitmq:3-management"
    hostname: "rabbit"
    env_file: .env
    ports:
      - "15672:15672"
      - "5672:5672"
    labels:
      NAME: "rabbitmq"
  
  elastic:
    restart: always
    image: elasticsearch:latest
    env_file: .env
    ports:
      - "9200:9200"
      - "9300:9300"
    volumes:
      - ./elasticsearch/storage/data:/usr/share/elasticsearch/data

  mongodb:
    image: mongo
    restart: always
    env_file: .env
    volumes:
      - ./data:/data/db
    ports:
      - "27017:27017"